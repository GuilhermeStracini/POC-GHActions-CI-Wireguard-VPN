name: Test VPN
on:
  pull_request:
  workflow_dispatch:

jobs:
 test-vpn:
    runs-on: ubuntu-latest

    steps:

    - name: Configure Wireguard SSH
      uses: omahn/wireguard-ssh-github-action@v1.4
      with:
        peer_ip: '${{ secrets.PEER_IP }}'
        ssh_public_key: 'VkufbU082p3Zag66kdVwcEwoc9k6xopIeAsS/Zuf9UA='
        peer_port: '51820'
        github_ip: '${{ secrets.CLIENT_IP }}'
        ssh_connection_timeout: '300'
        session_timeout: 3600

    - name: cURL webhooks.site
      run: |
        curl -A "POC-GHActions-CI-Wireguard-VPN (+https://github.com/GuilhermeStracini/POC-GHActions-CI-Wireguard-VPN)" ${{ secrets.WEBHOOK_ENDPOINT }}
